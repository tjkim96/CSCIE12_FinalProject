---
import Layout from "../../layouts/Layout.astro";
import coffee from "../../data/coffee.json";

export function getStaticPaths() {
    const countries = [
        ...new Set(coffee.map((c) => c?.Location?.Country).filter(Boolean)),
    ];

    // IMPORTANT: params should be RAW values (NOT encodeURIComponent)
    return countries.map((country) => ({
        params: { country },
    }));
}

// Astro.params.country will correspond to the URL segment.
// Decode just in case (safe for dev + prod).
const countryParam = decodeURIComponent(Astro.params.country);

// Normalize for comparisons
const selectedCountry = countryParam.trim();

const coffeesByCountry = coffee
    .filter((c) => (c?.Location?.Country ?? "").trim() === selectedCountry)
    .sort((a, b) => {
        const aScore =
            typeof a?.Data?.Scores?.Total === "number"
                ? a.Data.Scores.Total
                : -Infinity;
        const bScore =
            typeof b?.Data?.Scores?.Total === "number"
                ? b.Data.Scores.Total
                : -Infinity;
        return bScore - aScore;
    });

const count = coffeesByCountry.length;
---

<Layout title="Coffee Ratings Dataset">
    <h1>{selectedCountry} <span class="subtitle">({count} coffees)</span></h1>
    <p class="note">Sorted by Total Score (high → low).</p>

    <div class="grid">
        {
            coffeesByCountry.map((c) => (
                <article class="card">
                    <h2 class="region">{c?.Location?.Region ?? "Unknown"}</h2>
                    <dl class="meta">
                        <div>
                            <dt>Year</dt>
                            <dd>{c?.Year ?? "Unknown"}</dd>
                        </div>
                        <div>
                            <dt>Owner</dt>
                            <dd>{c?.Data?.Owner ?? "Unknown"}</dd>
                        </div>
                        <div>
                            <dt>Species</dt>
                            <dd>{c?.Data?.Type?.Species ?? "Unknown"}</dd>
                        </div>
                        <div>
                            <dt>Total Score</dt>
                            <dd>{c?.Data?.Scores?.Total ?? "Unknown"}</dd>
                        </div>
                    </dl>
                </article>
            ))
        }
    </div>
</Layout>

<style>
    .subtitle {
        font-size: 1rem;
        font-weight: 600;
        color: #4a3426;
    }

    .note {
        margin-top: 0.25rem;
        color: #4a3426;
        font-size: 1rem;
    }

    /* Grid spacing */
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 1.25rem;
        margin-top: 1.25rem;
    }

    /* Coffee-themed card: “label on paper” */
    .card {
        background: linear-gradient(180deg, #ffffff, #fff7ee);
        border: 1px solid #ead7c3;
        border-radius: 16px;
        padding: 1.1rem 1.15rem;
        box-shadow: 0 8px 22px rgba(0, 0, 0, 0.06);
        transition:
            transform 120ms ease,
            box-shadow 120ms ease;
        position: relative;
    }

    /* Small “bean” accent bar */
    .card::before {
        content: "";
        display: block;
        height: 6px;
        border-radius: 999px;
        margin-bottom: 0.9rem;
        background: linear-gradient(90deg, #6f4e37, #c28b64, #6f4e37);
        opacity: 0.9;
    }

    /* Hover “lift” */
    .card:hover {
        transform: translateY(-3px);
        box-shadow: 0 14px 30px rgba(0, 0, 0, 0.1);
    }

    /* Region title */
    .region {
        margin: 0 0 0.75rem 0;
        font-size: 1.15rem;
        font-weight: 800;
        color: #2b1b12; /* espresso */
        text-transform: capitalize;
    }

    /* Definition list */
    .meta {
        margin: 0;
        display: grid;
        gap: 0.65rem;
    }

    .meta > div {
        display: grid;
        grid-template-columns: 110px 1fr;
        gap: 0.9rem;
        align-items: baseline;
    }

    /* Labels: “tasting notes” look */
    dt {
        font-weight: 800;
        color: #6f4e37; /* mocha */
        letter-spacing: 0.02em;
    }

    /* Values */
    dd {
        margin: 0;
        color: #3a2416;
        overflow-wrap: anywhere; /* helps long owner names */
    }

    /* Page heading polish */
    h1 {
        margin-bottom: 0.25rem;
        font-size: 2.2rem;
        letter-spacing: -0.02em;
        color: #2b1b12;
    }

    @media (max-width: 700px) {
        .meta > div {
            grid-template-columns: 1fr;
            gap: 0.25rem;
        }
    }
</style>
